# Nginx configuration for ai-center.dk/AITrendTracker
# Place this file at: /etc/nginx/sites-available/ai-center.dk

server {
    listen 80;
    server_name ai-center.dk www.ai-center.dk;

    # Temporary placeholder for root (empty for now)
    location = / {
        add_header Content-Type text/plain;
        return 200 "Coming soon...\n";
    }

    # Redirect /aitrendtracker to /aitrendtracker/ (with trailing slash)
    location = /aitrendtracker {
        return 301 /aitrendtracker/;
    }

    # Proxy the Streamlit app under /aitrendtracker/
    location /aitrendtracker/ {
        proxy_pass http://127.0.0.1:8501/aitrendtracker/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;

        # Allow WebSocket connections for Streamlit
        proxy_set_header Sec-WebSocket-Extensions $http_sec_websocket_extensions;
        proxy_set_header Sec-WebSocket-Key $http_sec_websocket_key;
        proxy_set_header Sec-WebSocket-Version $http_sec_websocket_version;
    }
    
    # Proxy static files (CSS, JS, etc.) - these are served from the base path
    location ~ ^/aitrendtracker/(static|_stcore|health) {
        proxy_pass http://127.0.0.1:8501;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

